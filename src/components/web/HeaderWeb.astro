---
// HeaderWeb.astro - System Window Hero Design
import { Image } from 'astro:assets';
import logoImg from '../../assets/primitiva/primitiva_logo.svg';
---

<header class="relative bg-black text-white h-[100svh] flex flex-col p-6 md:py-8 md:px-12 border-b border-zinc-900 overflow-hidden">
  {/* Background Grid - Matching WebIdentity for consistency */}
  <div class="absolute inset-0 opacity-[0.03] pointer-events-none" style="background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px); background-size: 60px 60px;"></div>
  
  {/* System Header Bar */}
  <div class="w-full max-w-4xl md:max-w-none mx-auto md:mx-0 border-b border-zinc-900 bg-black px-2 md:px-0 py-3 flex items-center justify-between reveal-up active z-50 mb-2 md:mb-0">
    
    {/* Logo + System Log */}
    <div class="flex items-center gap-4">
      <a href="/">
        <img 
          src={logoImg.src} 
          alt="Logo Primitiva" 
          class="h-5 w-auto"
          loading="eager"
          width="100"
          height="20"
        />
      </a>
      <div class="hidden md:flex items-center" aria-hidden="true" role="presentation">
        <svg width="120" height="20" viewBox="0 0 120 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="opacity-30">
          <text x="0" y="14" fill="white" font-family="monospace" font-size="10" letter-spacing="2">V1.0 // JF_BR</text>
        </svg>
      </div>
    </div>

    {/* Navigation */}
    <nav class="flex items-center gap-4 md:gap-8">
      <a 
        href="/#about"
        class="nav-link-01 group flex items-center gap-1 font-mono text-[10px] md:text-xs font-bold tracking-wider uppercase text-zinc-400 hover:text-white transition-colors cursor-pointer"
      >
        <span>SOBRE</span>
      </a>

      <a 
        href="/contato/"
        class="nav-link-02 group flex items-center gap-2 font-mono text-[10px] md:font-display md:text-xs font-bold tracking-wider uppercase text-white md:border md:border-zinc-800 md:rounded md:bg-zinc-900/50 px-0 md:px-3 py-1.5 hover:border-zinc-600 transition-colors cursor-pointer"
      >
        <span>CONTATO</span>
        <span class="relative flex h-2 w-2 ml-1">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
        </span>
      </a>
    </nav>
  </div>

  <div class="flex-1 flex flex-col justify-center items-center w-full min-h-0 relative z-10" role="none">
      
      {/* System Window Container */}
      <div class="w-full max-w-4xl bg-zinc-950/50 border border-zinc-800 rounded-xl overflow-hidden shadow-2xl animate-fade-in group hover:border-zinc-700 transition-colors will-change-transform h-auto aspect-auto md:aspect-[16/9] lg:aspect-[2/1] min-h-[300px]">
          
          {/* macOS Style Header */}
          <div class="bg-zinc-900/80 border-b border-zinc-800 h-10 flex items-center px-4 gap-2">
              <div class="flex gap-2" role="none">
                  <div class="w-3 h-3 rounded-full bg-[#ff5f57] border border-black/10"></div>
                  <div class="w-3 h-3 rounded-full bg-[#febc2e] border border-black/10"></div>
                  <div class="w-3 h-3 rounded-full bg-[#28c840] border border-black/10"></div>
              </div>
              <div class="flex-1 text-center" aria-hidden="true" role="none">
                  <svg width="160" height="20" viewBox="0 0 160 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-auto block">
                    <text x="50%" y="14" fill="white" fill-opacity="0.2" font-family="monospace" font-size="10" text-anchor="middle" letter-spacing="1">CMD://EXEC_DISRUPT</text>
                  </svg>
              </div>
          </div>

          {/* Content Area */}
          <div class="p-8 md:p-12 lg:p-16 flex flex-col gap-2">
              <h2 class="font-display font-medium text-1xl md:text-4xl text-zinc-400 animate-slide-up" style="animation-delay: 0.2s">
                  TENHA A INFRAESTRUTURA
              </h2>
              <h1 class="font-display font-black text-4xl md:text-6xl lg:text-7xl leading-[0.9] tracking-tighter text-white uppercase animate-slide-up text-shadow-glow" style="animation-delay: 0.4s">
                  QUE SEU CONCORRENTE<br />
                  NÃO CONSEGUE COPIAR.
              </h1>

              {/* Technical Status Line Typewriter - NEW POSITION */}
              <div class="mt-8 md:mt-12 flex w-full h-auto min-h-[1.5rem] animate-fade-in" style="animation-delay: 0.6s">
                  <p id="status-line" class="font-mono text-[10px] md:text-[11px] uppercase tracking-wide flex flex-col items-start leading-relaxed">
                      <!-- Inline content populated by JS -->
                      <span class="inline-flex items-center">
                          <span id="status-text-1" class="text-green-500 mr-2"></span>
                          <span id="status-text-2" class="text-zinc-400"></span>
                          <span id="cursor-1" class="text-green-500 font-bold ml-[1px] opacity-0">_</span>
                      </span>
                      <span id="separator" class="hidden transition-opacity duration-300 opacity-0 md:hidden">//</span>
                      <span class="block mt-1 text-white font-bold opacity-90 max-w-2xl">
                          <span id="status-text-3"></span>
                          <span id="cursor-2" class="text-green-500 font-bold ml-[1px] opacity-0">_</span>
                      </span>
                  </p>
              </div>
          </div>
      </div>



      <script is:inline>
          function setupHeader() {
              const TARGET_TEXT_1 = "> STATUS: ";
              const TARGET_TEXT_2 = "Projetamos ecossistemas para escalar seu negócio com segurança e autoridade";
              
              const statusText1El = document.getElementById('status-text-1');
              const statusText2El = document.getElementById('status-text-2');
              const statusText3El = document.getElementById('status-text-3');
              const cursor1El = document.getElementById('cursor-1');
              const cursor2El = document.getElementById('cursor-2');
              const separatorEl = document.getElementById('separator');
              
              if (!statusText1El || !statusText2El || !statusText3El || !cursor1El || !cursor2El || !separatorEl) return;
              
              // Only run typewriter logic once if persistence is used (to avoid overlapping intervals)
              if (window.headerInitialized) return;
              window.headerInitialized = true;

              // Blinking cursor logic
              let blinkState = true;
              setInterval(() => {
                  blinkState = !blinkState;
                  const opacity = blinkState ? '1' : '0';
                  if (cursor1El.dataset.active === 'true') cursor1El.style.opacity = opacity;
                  if (cursor2El.dataset.active === 'true') cursor2El.style.opacity = opacity;
              }, 530);

              // Phase 0: Start delay
              setTimeout(() => {
                  cursor1El.dataset.active = 'true';
                  
                  // Typing Part 1
                  let charIndex1 = 0;
                  const text1Interval = setInterval(() => {
                       if (charIndex1 < TARGET_TEXT_1.length) {
                           const currentStr = TARGET_TEXT_1.slice(0, charIndex1 + 1);
                           const split = currentStr.split(':');
                           statusText1El.textContent = split[0] ? (currentStr.includes(':') ? '> STATUS:' : currentStr) : '';
                           statusText2El.textContent = currentStr.includes(':') ? split[1] : '';
                           charIndex1++;
                       } else {
                           clearInterval(text1Interval);
                           cursor1El.dataset.active = 'false';
                           cursor1El.style.opacity = '0';
                           separatorEl.classList.remove('opacity-0');
                           separatorEl.classList.add('opacity-100');
                           
                           // Phase 2: Typing Part 2
                           setTimeout(() => {
                               cursor2El.dataset.active = 'true';
                               let charIndex2 = 0;
                               const text2Interval = setInterval(() => {
                                   if (charIndex2 < TARGET_TEXT_2.length) {
                                       statusText3El.textContent = TARGET_TEXT_2.slice(0, charIndex2 + 1);
                                       charIndex2++;
                                   } else {
                                       clearInterval(text2Interval);
                                   }
                               }, 30);
                           }, 200);
                       }
                  }, 30);
              }, 1200);

              // Scroll to next section logic
              const scrollTrigger = document.getElementById('scroll-trigger');
              
              const scrollToNext = () => {
                  const nextSection = document.getElementById('identity');
                  if (nextSection) {
                      nextSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                  }
              };

              // Click action on indicator
              if (scrollTrigger) {
                  scrollTrigger.style.cursor = 'pointer';
                  scrollTrigger.classList.add('pointer-events-auto');
                  scrollTrigger.addEventListener('click', scrollToNext);
              }

              // Navigation-safe Scroll Actions (Using debouncing/isScrolling flag)
              let scrollActive = false;
              
              const handleWheel = (e) => {
                  if (window.scrollY < 50 && e.deltaY > 0 && !scrollActive) {
                      scrollActive = true;
                      scrollToNext();
                      setTimeout(() => { scrollActive = false; }, 1500);
                  }
              };

              let touchStartY = 0;
              const handleTouchStart = (e) => { touchStartY = e.touches[0].clientY; };
              
              const handleTouchMove = (e) => {
                  const touchEndY = e.touches[0].clientY;
                  const touchDiff = touchStartY - touchEndY;
                  
                  // Relaxed constraints for mobile (higher tolerance for initial native scroll)
                  if (window.scrollY < 150 && touchDiff > 30 && !scrollActive) {
                      scrollActive = true;
                      scrollToNext();
                      setTimeout(() => { scrollActive = false; }, 1500);
                  }
              };

              window.addEventListener('wheel', handleWheel, { passive: true });
              window.addEventListener('touchstart', handleTouchStart, { passive: true });
              window.addEventListener('touchmove', handleTouchMove, { passive: true });
          }

          // Handle initialization for both first load and View Transitions
          if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', setupHeader);
          } else {
              setupHeader();
          }
          document.addEventListener('astro:page-load', setupHeader);
      </script>

      {/* Hero Footer - Eliminating the black void */}
      <div class="absolute bottom-10 left-6 right-6 md:left-12 md:right-12 flex flex-col md:flex-row items-center justify-between gap-6 pointer-events-none z-20">
          
          {/* Scroll Indicator */}
          <div id="scroll-trigger" class="flex flex-col items-center gap-3 animate-fade-in" style="animation-delay: 1.5s">
              <span class="font-mono text-[8px] uppercase tracking-[0.3em] text-zinc-600">SCROLL_TO_MANIFESTO</span>
              <div class="w-[1px] h-12 bg-gradient-to-b from-zinc-800 to-transparent relative overflow-hidden">
                  <div class="absolute inset-0 w-full h-full bg-white animate-scroll-line"></div>
              </div>
          </div>

          {/* Technical Data Line */}
          <div class="hidden md:flex items-center gap-8 font-mono text-[8px] uppercase tracking-widest text-zinc-700">
              <div class="flex flex-col">
                  <span class="text-zinc-500">ENGINE_STATUS</span>
                  <span class="text-green-500/50">STABLE_V1.0.4</span>
              </div>
              <div class="flex flex-col">
                  <span class="text-zinc-500">DESIGN_SYSTEM</span>
                  <span>PRIMITIVA_CORE.LIB</span>
              </div>
              <div class="flex flex-col">
                  <span class="text-zinc-500">COORDINATES</span>
                  <span>21.7642° S, 43.3503° W</span>
              </div>
          </div>
      </div>
  </div>
</header>

<style>
    .text-shadow-glow {
        text-shadow: 0 0 40px rgba(255,255,255,0.1);
    }

    .nav-link-01::before {
        content: '[01]';
        color: rgba(255, 255, 255, 0.3);
        margin-right: 0.25rem;
        transition: color 0.2s ease;
    }
    .nav-link-01:hover::before {
        color: white;
    }

    .nav-link-02::before {
        content: '[02]';
        color: rgba(255, 255, 255, 0.3);
        margin-right: 0.5rem;
        transition: color 0.2s ease;
    }
    .nav-link-02:hover::before {
        color: white;
    }
    .will-change-transform {
        will-change: transform;
    }

    @keyframes scroll-line {
        0% { transform: translateY(-100%); }
        100% { transform: translateY(100%); }
    }

    .animate-scroll-line {
        animation: scroll-line 2s cubic-bezier(0.16, 1, 0.3, 1) infinite;
    }

    @keyframes fade-in {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .animate-fade-in {
        animation: fade-in 1s ease forwards;
    }
</style>
