---
import { Image } from 'astro:assets';

interface Props {
  src: ImageMetadata;
  alt: string;
  caption?: string;
  url?: string;
  height?: string;
  title?: string;
  loading?: "lazy" | "eager";
  skipLink?: string;
}

const { 
    src, 
    url, 
    alt = "Live Preview", 
    height = "h-[600px]", 
    title = "LIVE_SYSTEM_OVERRIDE",
    loading = "lazy",
    skipLink
} = Astro.props;
---

<div class="w-full reveal-up">
    {/* Terminal Header */}
    <div class="bg-zinc-900/50 rounded-t-lg border-x border-t border-zinc-800 p-3 flex items-center justify-between">
        <div class="flex gap-1.5">
            <div class="w-2.5 h-2.5 rounded-full bg-zinc-800"></div>
            <div class="w-2.5 h-2.5 rounded-full bg-zinc-800"></div>
            <div class="w-2.5 h-2.5 rounded-full bg-zinc-800"></div>
        </div>
        <div class="font-mono text-[10px] text-zinc-500 tracking-[0.2em] flex items-center gap-4 pl-8">
             {title}
             <span class="opacity-30">|</span>
             {skipLink ? (
                <a href={skipLink} class="text-zinc-400 hover:text-white transition-colors cursor-pointer uppercase flex items-center gap-1 group/btn border-b border-transparent hover:border-zinc-500 pb-0.5">
                    <span>PULAR PREVIEW</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="translate-y-px"><path d="M7 13l5 5 5-5M12 15V3"/></svg>
                </a>
             ) : (
                <>{url ? url.replace('https://', '') : 'INTERNAL_ASSET'}</>
             )}
        </div>
        
        <div class="w-12"></div> {/* Spacer */}
    </div>

    {/* Content Area */}
    <div class={`relative w-full ${height} overflow-hidden border-x border-b border-zinc-900 rounded-b-lg bg-black group`}>
        {url ? (
            /* Iframe View */
            <iframe 
                src={url} 
                class="w-full h-full border-none opacity-90 group-hover:opacity-100 transition-all duration-700 pointer-events-none" 
                title={alt}
                loading={loading}
                sandbox="allow-scripts allow-same-origin"
            ></iframe>
        ) : src ? (
            /* Image Scroll View */
            <div class="w-full h-full overflow-y-auto overflow-x-hidden scrollbar-hide">
                 <Image 
                    src={src} 
                    alt={alt}
                    class="w-full h-auto transition-all duration-1000"
                 />
            </div>
        ) : null}

        {/* Interaction Overlay (Scroll Guard) */}
        <div class="interaction-overlay absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/60 backdrop-blur-[2px] transition-opacity duration-500">
             <button class="start-interaction-btn px-5 py-2.5 bg-white text-black font-mono text-[10px] md:text-xs uppercase tracking-widest rounded-full hover:scale-105 active:scale-95 transition-transform shadow-[0_0_20px_rgba(255,255,255,0.3)] flex items-center gap-2 group/btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover/btn:rotate-90 transition-transform"><path d="M12 5v14M5 12h14"/></svg>
                <span>Iniciar Navegação</span>
             </button>
        </div>

        {/* Scanline Overlay */}
        <div class="absolute inset-0 pointer-events-none bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_2px] opacity-20"></div>
        <div class="absolute inset-0 pointer-events-none border border-white/5 group-hover:border-white/10 transition-colors"></div>
    </div>
    
    <div class="mt-4 flex justify-between items-center text-[9px] font-mono text-zinc-600 uppercase tracking-widest">
        <span>LINK: PEDE.CAFE/CARDAPIO</span>
        <span>RESOLUÇÃO: 1080x1920_MOBILE</span>
    </div>
</div>

<script>
    document.addEventListener('astro:page-load', () => {
        const buttons = document.querySelectorAll('.start-interaction-btn');
        
        buttons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const target = e.currentTarget as HTMLElement;
                const overlay = target.closest('.interaction-overlay');
                const container = overlay?.parentElement;
                const iframe = container?.querySelector('iframe');

                if (overlay && iframe) {
                    // Hide overlay with fade out
                    overlay.classList.add('opacity-0', 'pointer-events-none');
                    // Enable iframe interaction
                    iframe.classList.remove('pointer-events-none');
                }
            });
        });
    });
</script>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>
